# Node.js with React
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

parameters:
- name: environment
  type: string
- name: buildAndroid
  type: boolean
  default: $[contains(variables['Agent.JobName'], 'Android')]

# variables:
# - name: buildAndroid
#   value: $[contains(variables['Agent.JobName'], 'Android')]

steps:
- task: CmdLine@2
  displayName: Build Android
  condition: and(succeeded(), parameters.buildAndroid)
  inputs:
    script: |
      bundle exec fastlane android build version_code:$(Build.BuildId)

- task: CopyFiles@2
  displayName: Save compiled binary
  condition: and(succeeded(), parameters.buildAndroid)
  inputs:
    contents: android/**/*.apk
    TargetFolder: '$(Build.ArtifactStagingDirectory)'
    CleanTargetFolder: true
    OverWrite: true
