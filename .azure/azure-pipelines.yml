# Node.js with React
# Build a Node.js project that uses React.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

parameters:
  - name: Environment
    type: string
  - name: Platform
    type: string

pool:
  vmImage: 'ubuntu-latest'

steps:
  - script: |
      man ls > android/app/src/release.${{ parameters.Environment }}.apk
    displayName: Android apk
    condition: and(succeeded(), eq(variables['Platform'], 'android'))

  - script: |
      man ls > android/app/src/main/release.${{ parameters.Environment }}.aab
    displayName: Android aab
    condition: and(succeeded(), eq(variables['Platform'], 'android'))

  - script: |
      man rm > ios/ipa/release.${{ parameters.Environment }}.ipa
    displayName: iOS
    condition: and(succeeded(), eq(variables['Platform'], 'ios'))

  - task: CopyFiles@2
    displayName: Copy compiled binary
    inputs:
      contents: $(Contents)
      TargetFolder: '$(Build.ArtifactStagingDirectory)'
      CleanTargetFolder: true
      OverWrite: true

  - publish: $(Build.ArtifactStagingDirectory)
    artifact: $(Platform).${{ parameters.Environment }}.$(Build.BuildId)
    displayName: Publish artifact
